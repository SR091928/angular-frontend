<div class="signup-container">
  <h2 class="title">Signup</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <!-- Name Row -->
    <div class="row">
      <mat-form-field appearance="outline" class="field">
        <mat-label>First Name*</mat-label>
        <input matInput formControlName="firstName" />
        <mat-error *ngIf="form.get('firstName')?.touched && form.get('firstName')?.invalid">
          Required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="field">
        <mat-label>Last Name*</mat-label>
        <input matInput formControlName="lastName" />
        <mat-error *ngIf="form.get('lastName')?.touched && form.get('lastName')?.invalid">
          Required
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Address -->
    <mat-form-field appearance="outline" class="field full">
      <mat-label>Address</mat-label>
      <textarea matInput rows="2" formControlName="address"></textarea>
    </mat-form-field>

    <!-- Country / State / City -->
    <div class="row">
      <mat-form-field appearance="outline" class="field">
        <mat-label>Country*</mat-label>
        <mat-select formControlName="country" (selectionChange)="onCountryChange()">
          <mat-option value="">Select one</mat-option>
          <mat-option *ngFor="let c of countries" [value]="c.name">{{ c.name }}</mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('country')?.touched && form.get('country')?.hasError('required')">
          Required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="field">
        <mat-label>State*</mat-label>
        <mat-select
          formControlName="state"
          (selectionChange)="onStateChange()"
          [disabled]="!states.length"
        >
          <mat-option value="">Select one</mat-option>
          <mat-option *ngFor="let s of states" [value]="s">{{ s }}</mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('state')?.touched && form.get('state')?.hasError('required')">
          Required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="field">
        <mat-label>City*</mat-label>
        <mat-select formControlName="city" [disabled]="!cities.length">
          <mat-option value="">Select one</mat-option>
          <mat-option *ngFor="let c of cities" [value]="c">{{ c }}</mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('city')?.touched && form.get('city')?.hasError('required')">
          Required
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Mobile -->
    <div class="row phone-row">
      <div class="prefix-box">{{ selectedCountry.code }}</div>
      <mat-form-field appearance="outline" class="field phone-field">
        <mat-label>Mobile*</mat-label>
        <input
          matInput
          formControlName="mobile"
          autocomplete="tel-national"
          [maxlength]="selectedCountry.phoneLength"
        />
        <mat-error *ngIf="form.get('mobile')?.touched && form.get('mobile')?.invalid">
          Enter valid {{ selectedCountry.phoneLength }}-digit number
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Username -->
    <mat-form-field appearance="outline" class="field full">
      <mat-label>Username*</mat-label>
      <input matInput formControlName="username" autocomplete="username" />
      <mat-error *ngIf="form.get('username')?.touched && form.get('username')?.invalid">
        Required
      </mat-error>
    </mat-form-field>

    <!-- Passwords -->
    <div class="row">
      <mat-form-field appearance="outline" class="field password-field">
        <mat-label>Password*</mat-label>
        <input
          matInput
          [type]="hidePassword ? 'password' : 'text'"
          formControlName="password"
          autocomplete="new-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="togglePasswordVisibility()"
          aria-label="Show password"
        >
          <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="form.get('password')?.touched && form.get('password')?.invalid">
          Min 6 characters
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="field password-field">
        <mat-label>Re-type Password*</mat-label>
        <input
          matInput
          [type]="hideConfirmPassword ? 'password' : 'text'"
          formControlName="confirmPassword"
          autocomplete="new-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="toggleConfirmPasswordVisibility()"
          aria-label="Show confirm password"
        >
          <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="form.hasError('mismatch') && form.get('confirmPassword')?.touched">
          Passwords do not match
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Buttons -->
    <div class="actions">
      <button mat-raised-button color="primary" type="submit" class="signup-btn">
        Signup
      </button>
      <button mat-stroked-button color="primary" type="button" (click)="goBack()" class="back-btn">
        Back
      </button>
    </div>
  </form>
</div>
